#summary A brief overview of how data is received from the robot.
#labels Phase-Implementation,Featured

= Introduction =

This page provides a brief overview of how data is received from the robot in ControlForm.pas.

= Details =

Data received from the joystick (buttons and joystick values) are decoded in the *HidController1DeviceData* procedure in ControlForm.pas

The button states are stored in a global array of Boolean values numbered from 1..19 called *ButtonPressed* where:

1..12  correspond to the 12 joystick buttons

13..16 correspond to the D-pad directions Up, Right, Down, Left 

17     corresponds to the analog button

Positions 18 and 19 in the array aren't read from the joystick itself but they are used to store the left and right motor states (True = On, False = off) where:

18 is the left motor

19 is the right motor

The analog joystick values are stored in a global array of 4 Integer values called *AnalogJoyValues[0..3]* where:

0 is the Left X-axis

1 is the Left Y-axis

2 is the Right X-axis

3 is the Right Y-axis

The center position value on the joysticks is 127, so for a joystick's X-axis:

values < 127 -> left
values > 127 -> right

and for a Y-axis:

values < 127 -> up
values > 127 -> down

The HidController1DeviceData method is called automatically whenever data is received from the USB joystick and the array values are updated.  In addition, this method also:

1) Calls methods to update the button images (*UpdateImages*) and the joystick graphs (*UpdateGraphs*) in the telemetry window,

2) Writes data to the log file (if that option is selected on the Settings Form),

3) Checks the bump sensor (only applies in "Bump" mode), and

4) Plays the "Success" sound if it drives over a dark patch on the floor (in "Bump" and "Drive" modes).